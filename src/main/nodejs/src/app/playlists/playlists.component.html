<h1>Playlists</h1>

<!-- Toolbar -->
<div class="row no-gutters justify-content-between align-items-center my-3">
  <div class="col">
    <button type="button" class="btn btn-pink shadow" (click)="createPlaylist(playlistEditModal)"><i class="fas fa-plus"></i> Create</button>
  </div>
</div>

<!-- Playlists list -->
<div class="row" *ngIf="playlists; else playlistsLoading">
  <div class="col">
    <div class="list-group shadow mb-3" *ngIf="playlists.length > 0">
      <li *ngFor="let p of playlists; trackBy: trackByPlaylistId" (click)="gotoPlaylist(p)" class="list-group-item list-group-item-action d-flex align-items-center no-gutters px-3 py-2">
        <div class="col">
          <p class="m-0">
            <i class="fas fa-list mr-1" *ngIf="!p.restricted"></i>
            <i class="fas fa-lock mr-1" *ngIf="p.restricted && p.readOnly"></i>
            <i class="fas fa-lock-open mr-1" *ngIf="p.restricted && !p.readOnly"></i>
            {{ p.name }}
          </p>
        </div>
        <div class="col-auto d-none d-sm-block">
          <span class="badge badge-pink mx-1" *ngIf="p.songsCount" title="Songs count">{{ p.songsCount }} song{{ p.songsCount > 1 ? 's' : '' }}</span>
          <span class="badge badge-secondary mx-1" *ngIf="p.duration" title="Duration">{{ p.duration | duration }}</span>
        </div>
        <div class="col-auto ml-2">
          <button type="button" class="btn btn-outline-secondary mx-1" title="Edit playlist" (click)="$event.stopPropagation(); editPlaylist(playlistEditModal, p)"><i class="fas fa-edit"></i></button>
          <button type="button" class="btn btn-outline-danger mx-1" title="Delete playlist" (click)="$event.stopPropagation(); deletePlaylist(p)"><i class="far fa-trash-alt"></i></button>
        </div>
      </li>
    </div>
    <p *ngIf="playlists.length == 0">No playlist has been created yet.</p>
  </div>
</div>

<!-- Loading indicator -->
<ng-template #playlistsLoading>
  <div class="d-flex justify-content-center">
    <div class="spinner-border spinner-border-lg" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</ng-template>

<!-- Create playlist modal -->
<ng-template #playlistEditModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">{{ currentPlaylist.id ? 'Edit' : 'Create' }} playlist</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form #playlistEditForm="ngForm">
      <div class="form-group">
        <label for="playlistName">Name</label>
        <input type="text" class="form-control" id="playlistName" name="playlistName" [(ngModel)]="currentPlaylist.name" #playlistNameField="ngModel" [class.is-invalid]="playlistNameField.dirty && playlistNameField.invalid" placeholder="Playlist name" required>
      </div>
      <div class="form-group">
        <div class="custom-control custom-switch mt-3">
          <input type="checkbox" class="form-control custom-control-input" id="playlistRestricted" name="playlistRestricted" [(ngModel)]="currentPlaylist.restricted" #restrictedPlaylistField="ngModel">
          <label class="custom-control-label" for="playlistRestricted">Restricted playlist</label>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-pink" [disabled]="!playlistEditForm.form.valid" (click)="modal.close(currentPlaylist)">{{ currentPlaylist.id ? 'Save' : 'Create' }} playlist</button>
  </div>
</ng-template>
